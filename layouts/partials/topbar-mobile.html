<!-- Mobile Scrollable Left Sidebar (State 2) -->
<aside class="mobile-left-sidebar" id="mobile-left-sidebar">
  <div class="mobile-sidebar-content">
    {{ with .Site.Params.sidebar.avatar }}
      {{ if (default true .enabled) }}
        <figure class="site-avatar">
          <a href="{{ $.Site.BaseURL | relLangURL }}">
            {{ if not .local }}
              <img src="{{ .src }}" width="80" height="80" class="site-logo" loading="lazy" alt="Avatar">
            {{ else }}
              {{ $avatar := resources.Get (.src) }}
              {{ if $avatar }}
                {{ $avatarResized := $avatar.Resize "160x" }}
                <img src="{{ $avatarResized.RelPermalink }}" width="80" height="80" class="site-logo" loading="lazy" alt="Avatar">
              {{ else }}
                {{ errorf "Failed loading avatar from %q" . }}
              {{ end }}
            {{ end }}
          </a>
          {{ with $.Site.Params.sidebar.emoji }}
            <span class="emoji">{{ . }}</span>
          {{ end }}
        </figure>
      {{ end }}
    {{ end }}
    
    <div class="site-meta">
      <h1 class="site-name"><a href="{{ .Site.BaseURL | relLangURL }}">{{ .Site.Title }}</a></h1>
      <h2 class="site-description">{{ .Site.Params.sidebar.subtitle }}</h2>
    </div>

    {{- with .Site.Menus.social -}}
      <ol class="menu-social">
        {{ range . }}
          <li class="menu-social-item {{ if eq .Name "微信公众号" }}wechat-icon{{ end }}">
            <a 
              href='{{ .URL }}'
              {{ if eq (default true .Params.newTab) true }}target="_blank"{{ end }}
              {{ with .Name }}title="{{ . }}"{{ end }}
              rel="me"
            >
              {{ $icon := default "link" .Params.Icon }}
              {{ with $icon }}
                {{ partial "helper/icon" . }}
              {{ end }}
            </a>
            {{ if eq .Name "微信公众号" }}
              <div class="wechat-qrcode-popup">
                <img src="/icon-微信公众号.png" alt="微信公众号二维码" />
              </div>
            {{ end }}
          </li>
        {{ end }}
      </ol>
    {{- end -}}
  </div>
</aside>

<!-- Mobile Fixed Topbar (State 1) -->
<nav class="mobile-topbar" id="mobile-topbar">
  <div class="mobile-topbar__left">
    {{ with .Site.Params.sidebar.avatar }}
      {{ if (default true .enabled) }}
        <a href="{{ $.Site.BaseURL | relLangURL }}" class="mobile-topbar__avatar">
          {{ if not .local }}
            <img src="{{ .src }}" width="40" height="40" class="site-logo" loading="lazy" alt="Avatar">
          {{ else }}
            {{ $avatar := resources.Get (.src) }}
            {{ if $avatar }}
              {{ $avatarResized := $avatar.Resize "80x" }}
              <img src="{{ $avatarResized.RelPermalink }}" width="40" height="40" class="site-logo" loading="lazy" alt="Avatar">
            {{ else }}
              {{ errorf "Failed loading avatar from %q" . }}
            {{ end }}
          {{ end }}
        </a>
      {{ end }}
    {{ end }}
  </div>
  <div class="mobile-topbar__center">
    <a href="{{ .Site.BaseURL | relLangURL }}" class="mobile-topbar__title">{{ .Site.Title }}</a>
  </div>
  <div class="mobile-topbar__right">
    {{- with .Site.Menus.social -}}
      <ol class="menu-social">
        {{ range . }}
          <li class="menu-social-item {{ if eq .Name "微信公众号" }}wechat-icon{{ end }}">
            <a 
              href='{{ .URL }}'
              {{ if eq (default true .Params.newTab) true }}target="_blank"{{ end }}
              {{ with .Name }}title="{{ . }}"{{ end }}
              rel="me"
            >
              {{ $icon := default "link" .Params.Icon }}
              {{ with $icon }}
                {{ partial "helper/icon" . }}
              {{ end }}
            </a>
            {{ if eq .Name "微信公众号" }}
              <div class="wechat-qrcode-popup">
                <img src="/icon-微信公众号.png" alt="微信公众号二维码" />
              </div>
            {{ end }}
          </li>
        {{ end }}
      </ol>
    {{- end -}}
  </div>
</nav>

<!-- Fixed Menu Button (Always visible) -->
<button class="mobile-fixed-menu-button" id="mobile-menu-toggle" aria-label="{{ T `toggleMenu` }}">
  <span class="hamburger-box"><span class="hamburger-inner"></span></span>
</button>

<!-- Mobile Menu Overlay -->
<div class="mobile-menu-overlay" id="mobile-menu-overlay"></div>

<!-- Mobile Menu Container -->
<div class="mobile-menu-container" id="mobile-menu-container">
  <ol class="menu" id="mobile-main-menu">
    {{ $currentPage := . }}
    {{ range .Site.Menus.main }}
    {{ $active := or (eq $currentPage.Title .Name) (or ($currentPage.HasMenuCurrent "main" .) ($currentPage.IsMenuCurrent "main" .)) }}
    <li {{ if $active }} class='current' {{ end }}>
      <a href='{{ .URL }}' {{ if eq .Params.newTab true }}target="_blank"{{ end }}>
        {{ $icon := default .Pre .Params.Icon }}
        {{ if .Pre }}
          {{ warnf "Menu item [%s] is using [pre] field to set icon, please use [params.icon] instead.\nMore information: https://stack.jimmycai.com/config/menu" .URL }}
        {{ end }}
        {{ with $icon }}
          {{ partial "helper/icon" . }}
        {{ end }}
        <span>{{- .Name -}}</span>
      </a>
    </li>
    {{ end }}
    <li class="menu-bottom-section">
      <ol class="menu">
        {{- $currentLanguageCode := .Language.Lang -}}
        {{ if ( compare.Gt .Site.Home.AllTranslations.Len 1 ) }}
          {{ with .Site.Home.AllTranslations }}
            <li id="i18n-switch">  
              {{ partial "helper/icon" "language" }}
              <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                {{ range . }}
                  <option value="{{ .Permalink }}" {{ if eq .Language.Lang $currentLanguageCode }}selected{{ end }}>{{ .Language.LanguageName }}</option>
                {{ end }}
              </select>
            </li>
          {{ end }}
        {{ end }}

        {{ if (default false .Site.Params.colorScheme.toggle) }}
          <li id="dark-mode-toggle">
            {{ partial "helper/icon" "toggle-left" }}
            {{ partial "helper/icon" "toggle-right" }}
            <span>{{ T "darkMode" }}</span>
          </li>
        {{ end }}
      </ol>
    </li>
  </ol>
</div> 